@page "/root/createOrEditQuestionnaire"

@using Questionnaire.Blazor.Models.Questions
@using Questionnaire.Blazor.Models

<h3>Создать опросник</h3>
<EditForm OnSubmit=CreateQuestionnaire Model=formQuestionnaire Context="Questionnaire">
    <TextInputGroup @bind-ValueInput=formQuestionnaire.DisplayName Label=@DisplayNameLabel />
    <TextInputGroup @bind-ValueInput=formQuestionnaire.JsonName Label=@JsonNameLabel />

    <EditForm OnSubmit=AddQuestion Model=formQuestion Context="Question" class="m-4">
        <h4>Добавить вопрос</h4>
        <TextInputGroup @bind-ValueInput=formQuestion.DisplayName Label=@DisplayNameLabel />
        <TextInputGroup @bind-ValueInput=formQuestion.JsonName Label=@JsonNameLabel />
        <TextInputGroup @bind-ValueInput=formQuestion.DefaultValue Label=@DefaultValueLabel />
        <button class="btn btn-primary">Добавить вопрос</button>
    </EditForm>

    @foreach (var pair in formQuestionnaire.QuestionAnswerPairs)
    {
        <EditForm Model=pair.Key class="m-4">
            <TextInputGroup @bind-ValueInput=pair.Key.DisplayName Label=@DisplayNameLabel />
            <TextInputGroup @bind-ValueInput=pair.Key.JsonName Label=@JsonNameLabel />
            <TextInputGroup @bind-ValueInput=pair.Key.DefaultValue Label=@DefaultValueLabel />
        </EditForm>
    }
    <button class="btn btn-success">Создать опросник</button>
</EditForm>

@code {
    private QuestionnaireModel formQuestionnaire = new();
    private TextQuestion formQuestion = new();

    private const string DisplayNameLabel = "Отображаемое имя вопроса";
    private const string JsonNameLabel = "Имя вопроса в json";
    private const string DefaultValueLabel = "Значение по умолчанию";
    private const string QuestionTypeLabel = "Тип вопроса";

    private void AddQuestion()
    {
        TextQuestion newQuestion = new()
        {
            DisplayName = formQuestion.DisplayName,
            JsonName = formQuestion.JsonName,
        };

        formQuestionnaire.QuestionAnswerPairs.Add(newQuestion, new Answer(newQuestion.Id));
        StateHasChanged();
    }

    private void CreateQuestionnaire()
    {

    }
}
